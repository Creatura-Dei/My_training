<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>21</title>
</head>
<body>
    
    Конструктор, оператор New 


{...} - один объект

Если нужно много однотипных (пользователи, элементы меню) - используем функцию-конструктор и оператор "new"
_________________________________________________________________________



Функция-конструктор

Обычная функция с двумя соглашениями:

1) Имя функции-конструктора должно начинаться только с помощью оператора "new"

2) Функция-конструктор должна выполняться только с помощью оператора "new"




Когда функция вызывается как new User(...), происходит следующее: 

    1) Создаётся новый пустой объект, и он присваивается this 
    2) Выполняется тело функции. Обычно оно модифицирует this, добавляя туда новые свойства
    3) Возвращается значение this. 


        function User(name) {
            this.name = name;
            this.isAdmin = false;
        }

        let user = new User("Jack");

        alert(user.name); // Jack
        alert(user.isAdmin); // false



    ТО ЕСТЬ, new User(...) Делает что-то вроде:

        function User(name) {
            //this = {} (неявно)

            //Добавляет свойства к this
            this.name = name;
            this.isAdmin = false;
            
            //return this; (неявно)
        }  
        
    

    Таким образом:
        let user = new User("Jack") возвращает тот же результат, что и 

        let user = {
            name: "Jack",
            isAdmin: false,
        };




Если нужно будет создать других пользователей - вызываем
    new User("Ann"), 
    new User("Alice")







ТО ЕСТЬ – технически любая функция (кроме стрелочных функций, поскольку у них нет this) может использоваться в качестве конструктора. Его можно запустить с помощью new, и он выполнит выше указанный алгоритм. Подобные функции должны начинаться с заглавной буквы – это общепринятое соглашение, чтобы было ясно, что функция должна вызываться с помощью «new».
















new function() {...}

Если в коде много строк, создающих один большой сложный объект, то нужно обернуть их в функцию-конструктор, которая немедленно вызывается так:

        //создаём функцию и сразу же вызываем её с помощью new 

        let user = new function() {
            this.name = "John";
            this.isAdmin = false;
        };

Такой конструктор не может быть вызван снова, так как он нигде не сохраняется, просто создаётся + вызывается. 







ПРОВЕРКА НА ВЫЗОВ В РЕЖИМЕ КОНСТРУКТОРА: new.target


Используя специальное свойство new.target ВНУТРИ функции, можно проверить, вызвана ли функции оператора new или без него. 


ЕСЛИ вызов был обычный - new.target === undefined. 
Если вызов был при помощи new - new.target == САМОЙ ФУНКЦИИ 


        function User() {
            alert(new.target);
        }

            //без "new"
        User(); // undefined

            //с "new"
        new User(); // function User {...}


Это можно использовать внутри функции, чтобы узнать, была ли она вызвана при помощи new - в режиме конструктора
       без new - в обычном режиме

 
       







ВОЗВРАТ ЗНАЧЕНИЯ ИЗ КОНТСТРУКТОРА, return 

Если return все же есть в функции, то применяется правило:


        1) При вызове return с объектом, вместо this вернется объект. 
        2) При вызове return с примитивным значением, оно проигнорируется



ТО ЕСТЬ 
return с объектом возвращает ЭТОТ объект, иначе ВОЗВРАЩАЕТСЯ this

    Здесь return замещает this, возвращая объект:


        function BigUser() {
            this.name = "John";
            
            return { name: "Godzilla" }; // <-- возвращает этот объект
        }

        alert( new BigUser().name ); // Godzilla, ТОТ САМЫЙ объект






    
    А тут с пустым return (или можно было поставить примитив после return): 
        

        function SmallUser() {
            this.name = "John";
            return; // <-- возвращает this 
        }

        alert( new SmallUser().name ); // John
        
        
КАК ПРАВИЛО У КОНСТРУКТОРОВ ОТСТУТСТВУЕТ return








ПРОПУСК КРУГЛЫХ СКОБОК - ЛУЧШЕ НЕ ИСПОЛЬЗОВАТЬ


    Можно не ставить круглые скобки после new: 

        let user = new User; // <-- без скобок 

    // ТОЧНО ТАК ЖЕ, КАК И 

        let user - new User();






СОЗДАНИЕ МЕТОДОВ В КОНСТРУКТОРЕ

К this можно добавить не только свойства, но и методы.

Например, new User(name) создаёт объект с заданным name и методом sayHi:


function User(name) {
    this.name = name;
    
    this.sayHi = function() {
        alert( "Меня зовут: " + this.name);
    };
}

let john = new User("John");

john.sayHi(); // Меня зовут: John


<!-- 
    john = {
        name: "John",
        sayHi: function() {...}
    }
 -->




        




</body>
</html>